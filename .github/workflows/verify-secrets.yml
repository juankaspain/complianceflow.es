name: Verify Secrets Configuration

on:
  workflow_dispatch:

jobs:
  verify-secrets:
    name: Verify Secrets
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Check CODECOV_TOKEN
        run: |
          if [ -z "${{ secrets.CODECOV_TOKEN }}" ]; then
            echo "❌ CODECOV_TOKEN: NOT CONFIGURED"
            echo "::error::CODECOV_TOKEN is not set"
          else
            TOKEN_LENGTH=${#CODECOV_TOKEN}
            echo "✅ CODECOV_TOKEN: CONFIGURED (length: $TOKEN_LENGTH characters)"
          fi
        env:
          CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}

      - name: Check SNYK_TOKEN
        run: |
          if [ -z "${{ secrets.SNYK_TOKEN }}" ]; then
            echo "❌ SNYK_TOKEN: NOT CONFIGURED"
            echo "::error::SNYK_TOKEN is not set"
          else
            TOKEN_LENGTH=${#SNYK_TOKEN}
            echo "✅ SNYK_TOKEN: CONFIGURED (length: $TOKEN_LENGTH characters)"
          fi
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: Check LHCI_GITHUB_APP_TOKEN
        run: |
          if [ -z "${{ secrets.LHCI_GITHUB_APP_TOKEN }}" ]; then
            echo "❌ LHCI_GITHUB_APP_TOKEN: NOT CONFIGURED"
            echo "::error::LHCI_GITHUB_APP_TOKEN is not set"
          else
            TOKEN_LENGTH=${#LHCI_GITHUB_APP_TOKEN}
            echo "✅ LHCI_GITHUB_APP_TOKEN: CONFIGURED (length: $TOKEN_LENGTH characters)"
          fi
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

      - name: Check NETLIFY_AUTH_TOKEN
        run: |
          if [ -z "${{ secrets.NETLIFY_AUTH_TOKEN }}" ]; then
            echo "❌ NETLIFY_AUTH_TOKEN: NOT CONFIGURED"
            echo "::error::NETLIFY_AUTH_TOKEN is not set"
          else
            TOKEN_LENGTH=${#NETLIFY_AUTH_TOKEN}
            echo "✅ NETLIFY_AUTH_TOKEN: CONFIGURED (length: $TOKEN_LENGTH characters)"
          fi
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}

      - name: Check NETLIFY_SITE_ID
        run: |
          if [ -z "${{ secrets.NETLIFY_SITE_ID }}" ]; then
            echo "❌ NETLIFY_SITE_ID: NOT CONFIGURED"
            echo "::error::NETLIFY_SITE_ID is not set"
          else
            ID_LENGTH=${#NETLIFY_SITE_ID}
            echo "✅ NETLIFY_SITE_ID: CONFIGURED (length: $ID_LENGTH characters)"
          fi
        env:
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}

      - name: Summary Report
        if: always()
        run: |
          echo "# Secrets Configuration Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Required secrets
          echo "### Required Secrets" >> $GITHUB_STEP_SUMMARY
          if [ -n "${{ secrets.NETLIFY_AUTH_TOKEN }}" ]; then
            echo "- ✅ NETLIFY_AUTH_TOKEN" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ❌ NETLIFY_AUTH_TOKEN (REQUIRED)" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ -n "${{ secrets.NETLIFY_SITE_ID }}" ]; then
            echo "- ✅ NETLIFY_SITE_ID" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ❌ NETLIFY_SITE_ID (REQUIRED)" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Optional Secrets (Enhance Features)" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "${{ secrets.CODECOV_TOKEN }}" ]; then
            echo "- ✅ CODECOV_TOKEN (Test coverage reports)" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ⚠️ CODECOV_TOKEN (Optional - for test coverage reports)" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ -n "${{ secrets.SNYK_TOKEN }}" ]; then
            echo "- ✅ SNYK_TOKEN (Security scanning)" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ⚠️ SNYK_TOKEN (Optional - for advanced security scanning)" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ -n "${{ secrets.LHCI_GITHUB_APP_TOKEN }}" ]; then
            echo "- ✅ LHCI_GITHUB_APP_TOKEN (Lighthouse CI)" >> $GITHUB_STEP_SUMMARY
          else
            echo "- ⚠️ LHCI_GITHUB_APP_TOKEN (Optional - for Lighthouse performance monitoring)" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Note**: Token values are never exposed in logs for security reasons." >> $GITHUB_STEP_SUMMARY
          echo "Only their presence and length are checked." >> $GITHUB_STEP_SUMMARY
